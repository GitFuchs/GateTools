#!/usr/bin/env python3
# -----------------------------------------------------------------------------
#   Copyright (C): OpenGATE Collaboration
#   This software is distributed under the terms
#   of the GNU Lesser General  Public Licence (LGPL)
#   See LICENSE.md for further details
# -----------------------------------------------------------------------------

import gatetools as gt
import itk
import click
import logging
logger=logging.getLogger(__name__)

# -----------------------------------------------------------------------------
CONTEXT_SETTINGS = dict(help_option_names=['-h', '--help'])
@click.command(context_settings=CONTEXT_SETTINGS)

@click.option('--input', '-i', help='Input image filename', required=True,
                type=click.Path(dir_okay=False))
@click.option('--dicom', '-d', help='Input Dicom file example',
                type=click.Path(dir_okay=False))
@click.option('--output', '-o', default='output.dcm', help='Output dicom filename')

@gt.add_options(gt.common_options)
def gt_write_dicom_main(input, dicom, output, **kwargs):
    '''
    Convert the input image (usually mhd, nii, ...) to dicom format.
    If dicom is set, take the tags of dicom as model for the output.
    Write the dicom volume as output
    '''

    # logger
    gt.logging_conf(**kwargs)

    inputImage = itk.imread(input)
    gt.writeDicom(inputImage, dicom, output)


# -----------------------------------------------------------------------------
if __name__ == '__main__':
    gt_write_dicom_main()
